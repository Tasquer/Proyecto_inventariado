{% extends "base.html" %}

{% block title %}Reportes de Inventario{% endblock %}

{% block content %}
<div class="row">
  <div class="col-md-8 offset-md-2">
    <div class="card shadow-sm">
      <div class="card-body">
        <h2 class="card-title">{{ chart_title|default:"Reporte" }}</h2>
        <p class="card-subtitle mb-2 text-muted">
          Distribución de productos en el inventario.
        </p>
        
        <hr>
        
        <div style="width: 100%; max-height: 500px; position: relative;">
          <canvas id="graficoReporte"></canvas>
        </div>

      </div>
    </div>
  </div>
</div>

{% endblock %}


{% block scripts %}
{{ block.super }} 

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    
    const ctx = document.getElementById('graficoReporte').getContext('2d');
    
    // 3. Traemos los datos que la vista de Django nos pasó
    const labels = JSON.parse('{{ chart_labels|safe }}' || '[]');
    const datasets = JSON.parse('{{ chart_datasets|safe }}' || '[]');
    const chartTitle = '{{ chart_title|safe }}';

    // 4. Creamos el nuevo gráfico (¡TIPO 'pie'!)
    new Chart(ctx, {
      type: 'pie', // <-- CAMBIO A GRÁFICO DE PIE
      data: {
        labels: labels,     // Eje X: los días
        datasets: datasets  // Los grupos de datos (Lacteos, Chocolate, etc.)
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'top',
          },
          title: {
            display: true,
            text: chartTitle
          }
        }
      }
    });

  });
</script>
{% endblock %}